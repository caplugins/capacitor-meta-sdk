{"version":3,"file":"plugin.cjs.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst MetaSDK = registerPlugin('MetaSDK', {\n    web: () => import('./web').then((m) => new m.MetaSDKWeb()),\n});\nexport * from './definitions';\nexport { MetaSDK };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nconst META_STANDARD_EVENTS = new Set([\n    'AddPaymentInfo',\n    'AddToCart',\n    'AddToWishlist',\n    'CompleteRegistration',\n    'Contact',\n    'CustomizeProduct',\n    'Donate',\n    'FindLocation',\n    'InitiateCheckout',\n    'Lead',\n    'Purchase',\n    'Schedule',\n    'Search',\n    'StartTrial',\n    'SubmitApplication',\n    'Subscribe',\n    'ViewContent',\n]);\n/**\n * Web implementation of the Meta SDK.\n * This injects the Meta Pixel (fbevents.js) into the DOM and bridges the App Event calls to fbq().\n */\nexport class MetaSDKWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.isInitialized = false;\n        this.isDisabled = false;\n    }\n    /**\n     * Internal fbq queue checking wrapper.\n     */\n    get fbq() {\n        return window.fbq;\n    }\n    async initialize(options) {\n        if (options.disabledPlatforms?.includes('web')) {\n            this.isDisabled = true;\n            if (options.debug) {\n                console.log('[MetaSDK] Web platform is disabled via init options.');\n            }\n            return;\n        }\n        if (this.isInitialized) {\n            return;\n        }\n        if (!options.appId) {\n            throw new Error('[MetaSDK] appId must be provided to initialize the web plugin.');\n        }\n        if (options.debug) {\n            console.log(`[MetaSDK] Initializing Web SDK with App ID: ${options.appId}`);\n        }\n        // Standard Meta Pixel snippet\n        /* eslint-disable */\n        (function (f, b, e, v, n, t, s) {\n            if (f.fbq)\n                return;\n            n = f.fbq = function () {\n                n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);\n            };\n            if (!f._fbq)\n                f._fbq = n;\n            n.push = n;\n            n.loaded = !0;\n            n.version = '2.0';\n            n.queue = [];\n            t = b.createElement(e);\n            t.async = !0;\n            t.src = v;\n            s = b.getElementsByTagName(e)[0];\n            s.parentNode.insertBefore(t, s);\n        })(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');\n        /* eslint-enable */\n        this.fbq('init', options.appId);\n        this.isInitialized = true;\n    }\n    async logEvent(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] logEvent called before initialization or fbq is blocked.');\n            return;\n        }\n        if (META_STANDARD_EVENTS.has(options.name)) {\n            this.fbq('track', options.name, options.parameters || {});\n        }\n        else {\n            this.fbq('trackCustom', options.name, options.parameters || {});\n        }\n    }\n    async logPurchase(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] logPurchase called before initialization or fbq is blocked.');\n            return;\n        }\n        const payload = {\n            value: options.amount,\n            currency: options.currency,\n            ...(options.parameters || {}),\n        };\n        this.fbq('track', 'Purchase', payload);\n    }\n    async setUserData(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] setUserData called before initialization or fbq is blocked.');\n            return;\n        }\n        // Map straightforward fields to Meta's expected Advanced Matching keys\n        const advancedMatching = {};\n        if (options.email)\n            advancedMatching.em = options.email;\n        if (options.phone)\n            advancedMatching.ph = options.phone;\n        // Pass through any other properties assuming the developer formatted them correctly\n        for (const key of Object.keys(options)) {\n            if (key !== 'email' && key !== 'phone' && options[key]) {\n                advancedMatching[key] = options[key];\n            }\n        }\n        // You must call init again with user data to properly associate it\n        // Assuming initialize was called with appId, but the web SDK lets you set user data globally or via init.\n        // The best supported modern approach is pushing an 'init' call with data.\n        // Note: Since we don't store appId in instance variables (the pixel handles it),\n        // we can push user properties directly if we know them.\n        // But for a pure capacitor wrapper, we'll try to push it to the queue.\n        console.warn('[MetaSDK] Advanced matching via setUserData on Web currently requires passing it during the initial initialization for optimal matching. Applying loosely to current state.');\n        // In raw FBQ, user data can be pushed as a 3rd arg to init: fbq('init', '{pixel-id}', {em: 'xxx'})\n        // Without re-initializing, it's safer to just log that the user should pass it at init on the web.\n    }\n    async setAutoLogAppEventsEnabled(_options) {\n        // No-op for web. FBQ relies on standard web pixel configuration and cookies.\n        if (this.isDisabled)\n            return;\n    }\n    async setAdvertiserTrackingEnabled(_options) {\n        // No-op for web. Relevant mostly for iOS ATT.\n        if (this.isDisabled)\n            return;\n    }\n    async setAdvertiserIDCollectionEnabled(_options) {\n        // No-op for web.\n        if (this.isDisabled)\n            return;\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}