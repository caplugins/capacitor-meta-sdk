{"version":3,"file":"plugin.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst MetaSDK = registerPlugin('MetaSDK', {\n    web: () => import('./web').then((m) => new m.MetaSDKWeb()),\n});\nexport * from './definitions';\nexport { MetaSDK };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nconst META_STANDARD_EVENTS = new Set([\n    'AddPaymentInfo',\n    'AddToCart',\n    'AddToWishlist',\n    'CompleteRegistration',\n    'Contact',\n    'CustomizeProduct',\n    'Donate',\n    'FindLocation',\n    'InitiateCheckout',\n    'Lead',\n    'Purchase',\n    'Schedule',\n    'Search',\n    'StartTrial',\n    'SubmitApplication',\n    'Subscribe',\n    'ViewContent',\n]);\n/**\n * Web implementation of the Meta SDK.\n * This injects the Meta Pixel (fbevents.js) into the DOM and bridges the App Event calls to fbq().\n */\nexport class MetaSDKWeb extends WebPlugin {\n    constructor() {\n        super(...arguments);\n        this.isInitialized = false;\n        this.isDisabled = false;\n    }\n    /**\n     * Internal fbq queue checking wrapper.\n     */\n    get fbq() {\n        return window.fbq;\n    }\n    async initialize(options) {\n        if (options.disabledPlatforms?.includes('web')) {\n            this.isDisabled = true;\n            if (options.debug) {\n                console.log('[MetaSDK] Web platform is disabled via init options.');\n            }\n            return;\n        }\n        if (this.isInitialized) {\n            return;\n        }\n        if (!options.appId) {\n            throw new Error('[MetaSDK] appId must be provided to initialize the web plugin.');\n        }\n        if (options.debug) {\n            console.log(`[MetaSDK] Initializing Web SDK with App ID: ${options.appId}`);\n        }\n        // Standard Meta Pixel snippet\n        /* eslint-disable */\n        (function (f, b, e, v, n, t, s) {\n            if (f.fbq)\n                return;\n            n = f.fbq = function () {\n                n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);\n            };\n            if (!f._fbq)\n                f._fbq = n;\n            n.push = n;\n            n.loaded = !0;\n            n.version = '2.0';\n            n.queue = [];\n            t = b.createElement(e);\n            t.async = !0;\n            t.src = v;\n            s = b.getElementsByTagName(e)[0];\n            s.parentNode.insertBefore(t, s);\n        })(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');\n        /* eslint-enable */\n        this.fbq('init', options.appId);\n        this.isInitialized = true;\n    }\n    async logEvent(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] logEvent called before initialization or fbq is blocked.');\n            return;\n        }\n        if (META_STANDARD_EVENTS.has(options.name)) {\n            this.fbq('track', options.name, options.parameters || {});\n        }\n        else {\n            this.fbq('trackCustom', options.name, options.parameters || {});\n        }\n    }\n    async logPurchase(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] logPurchase called before initialization or fbq is blocked.');\n            return;\n        }\n        const payload = {\n            value: options.amount,\n            currency: options.currency,\n            ...(options.parameters || {}),\n        };\n        this.fbq('track', 'Purchase', payload);\n    }\n    async setUserData(options) {\n        if (this.isDisabled)\n            return;\n        if (!this.isInitialized || !this.fbq) {\n            console.warn('[MetaSDK] setUserData called before initialization or fbq is blocked.');\n            return;\n        }\n        // Map straightforward fields to Meta's expected Advanced Matching keys\n        const advancedMatching = {};\n        if (options.email)\n            advancedMatching.em = options.email;\n        if (options.phone)\n            advancedMatching.ph = options.phone;\n        // Pass through any other properties assuming the developer formatted them correctly\n        for (const key of Object.keys(options)) {\n            if (key !== 'email' && key !== 'phone' && options[key]) {\n                advancedMatching[key] = options[key];\n            }\n        }\n        // You must call init again with user data to properly associate it\n        // Assuming initialize was called with appId, but the web SDK lets you set user data globally or via init.\n        // The best supported modern approach is pushing an 'init' call with data.\n        // Note: Since we don't store appId in instance variables (the pixel handles it),\n        // we can push user properties directly if we know them.\n        // But for a pure capacitor wrapper, we'll try to push it to the queue.\n        console.warn('[MetaSDK] Advanced matching via setUserData on Web currently requires passing it during the initial initialization for optimal matching. Applying loosely to current state.');\n        // In raw FBQ, user data can be pushed as a 3rd arg to init: fbq('init', '{pixel-id}', {em: 'xxx'})\n        // Without re-initializing, it's safer to just log that the user should pass it at init on the web.\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}